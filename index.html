<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click Plumbing - Hydrostatic Test Report</title>
    <link rel="icon" href="img/favicon.svg" type="image/svg+xml">
    <link rel="shortcut icon" href="img/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="js/date-fix.js"></script>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4 report-title-custom">Click Plumbing Test Report Generator <i class="fas fa-wrench"></i></h1>
                <div class="card mb-3">
                    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <button class="btn btn-link text-white" type="button" data-bs-toggle="collapse" data-bs-target="#prefillCollapse" aria-expanded="false" aria-controls="prefillCollapse">
                                Pre-filled Fields
                            </button>
                        </h5>
                        <button type="button" class="btn btn-sm btn-outline-light" id="shareCustomerInfo" title="Generate shareable URL with customer information">
                            <i class="fas fa-share-alt me-1"></i> Share Customer Information
                        </button>
                    </div>
                    <div class="collapse" id="prefillCollapse">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="systemTested" class="form-label">System Tested</label>
                                        <input type="text" class="form-control" id="systemTested" value="Underground sewer lines and associated components.">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="testMethod" class="form-label">Test Method</label>
                                        <input type="text" class="form-control" id="testMethod" value="Water column test with no applied pressure.">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="testPressure" class="form-label">Test Pressure</label>
                                        <input type="text" class="form-control" id="testPressure" value="10 feet of head pressure">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="passConclusion" class="form-label">Pass Conclusion</label>
                                        <textarea class="form-control" id="passConclusion" rows="3">The system is functioning properly at this time. The consistency in water levels throughout the duration of the test indicates the absence of leaks in the sewer lines.</textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="failConclusion" class="form-label">Fail Conclusion</label>
                                        <textarea class="form-control" id="failConclusion" rows="3">The system is not functioning properly at this time. The consistency in water levels throughout the duration of the test indicates leaks in the sewer lines.</textarea>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="certification" class="form-label">Certification</label>
                                        <textarea class="form-control" id="certification" rows="6">I hereby certify that the Hydrostatic Test was performed according to industry standards and local
code requirements. All reports only represent measurements taken at this time.

Malachi Whites (#RMP41130)
Click Plumbing
Office: (801) 252-5155
TSBPE: 929 East 41st St Austin TX 78751</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Test Information</h5>
                    </div>
                    <div class="card-body">
                        <form id="hydroTestForm">
                            <!-- Customer Information -->
                            <div class="row mb-3">
                                <div class="col-12 d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="mb-0">Customer Information</h4>
                                    <div class="quick-fill-container" style="max-width: 400px; flex: 1; margin-left: 20px;">
                                        <label for="quickFill" class="form-label mb-1" style="font-size: 0.875rem;">Quick Fill</label>
                                        <input type="text" class="form-control form-control-sm" id="quickFill" placeholder="Paste: Name, Address, Email, Phone">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="customerName" class="form-label">Customer Name</label>
                                        <input type="text" class="form-control" id="customerName" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="customerEmail" class="form-label">Customer Email</label>
                                        <input type="email" class="form-control" id="customerEmail">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="customerPhone" class="form-label">Customer Phone</label>
                                        <input type="tel" class="form-control" id="customerPhone">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="customerCompany" class="form-label">Company (Optional)</label>
                                        <input type="text" class="form-control" id="customerCompany">
                                    </div>
                                </div>
                            </div>

                            <!-- Test Location and Date -->
                            <div class="row mb-3">
                                <div class="col-12">
                                    <h4>Test Location and Date</h4>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="testLocation" class="form-label">Full Address</label>
                                        <textarea class="form-control" id="testLocation" rows="3" required placeholder="Enter complete address including street, city, state, and zip code"></textarea>
                                        <!-- Hidden fields to store the old values for compatibility -->
                                        <input type="hidden" id="testAddress">
                                        <input type="hidden" id="testCity">
                                        <input type="hidden" id="testState" value="TX">
                                        <input type="hidden" id="testZip">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="testDate" class="form-label">Test Date</label>
                                        <div class="input-group">
                                            <input type="date" class="form-control" id="testDate" required>
                                            <div class="btn-group" role="group">
                                                <button type="button" class="btn btn-outline-secondary date-btn" data-date="yesterday">Yesterday</button>
                                                <button type="button" class="btn btn-outline-secondary date-btn" data-date="today">Today</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Test Type -->
                            <div class="row mb-3">
                                <div class="col-12">
                                    <h4>Test Type</h4>
                                    <p class="text-muted mb-3">Select the type of test being performed:</p>
                                    <div class="d-flex flex-column flex-md-row gap-3 mb-3">
                                        <button type="button" class="btn btn-outline-primary btn-lg test-type-btn flex-fill" data-test-type="pre-test">
                                            <i class="fas fa-arrow-circle-left me-2"></i>Pre-Test
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-lg test-type-btn flex-fill" data-test-type="post-test">
                                            <i class="fas fa-arrow-circle-right me-2"></i>Post-Test
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-lg test-type-btn flex-fill" data-test-type="pinpoint-test">
                                            <i class="fas fa-crosshairs me-2"></i>Pinpoint Test
                                        </button>
                                    </div>
                                    <input type="hidden" id="testType" required>
                                </div>
                            </div>

                            <!-- Supply/Sewer Selection (Conditional) -->
                            <div class="row mb-3" id="supplySewerContent" style="display: none;">
                                <div class="col-12">
                                    <p class="text-muted mb-3">Select the system type:</p>
                                    <div class="d-flex flex-column flex-md-row gap-3 mb-3">
                                        <button type="button" class="btn btn-outline-warning btn-lg supply-sewer-btn flex-fill" data-supply-sewer="supply">
                                            <i class="fas fa-faucet me-2"></i>Supply
                                        </button>
                                        <button type="button" class="btn btn-outline-warning btn-lg supply-sewer-btn flex-fill" data-supply-sewer="sewer">
                                            <i class="fas fa-toilet me-2"></i>Sewer
                                        </button>
                                    </div>
                                    <input type="hidden" id="supplySewer" value="">
                                </div>
                            </div>

                            <!-- Pinpoint Test Content (Conditional) -->
                            <div class="row mb-3" id="pinpointTestContent" style="display: none;">
                                <div class="col-12">
                                    <div class="card border-warning">
                                        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Pinpoint Test Information</h5>
                                            <button type="button" class="btn btn-sm btn-outline-light" id="sharePinpointInfo" title="Generate shareable URL with pinpoint test information">
                                                <i class="fas fa-share-alt me-1"></i> Share Test and Customer Information
                                            </button>
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-3">
                                                <label for="pinpointLocation" class="form-label">Pinpoint Location</label>
                                                <textarea class="form-control" id="pinpointLocation" rows="2" placeholder="Describe the specific location where the pinpoint test was performed"></textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label for="pinpointMethod" class="form-label">Pinpoint Test Method</label>
                                                <textarea class="form-control" id="pinpointMethod" rows="2" placeholder="Describe the method used for pinpoint testing"></textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label for="pinpointFindings" class="form-label">Pinpoint Findings</label>
                                                <textarea class="form-control" id="pinpointFindings" rows="3" placeholder="Describe the findings from the pinpoint test. EXAMPLE: Testing revealed a major separation/break at the second wye fitting approximately 25â€“26 ft from the exterior clean-out. The break is large enough that base material is actively entering the pipe, and the system will not hold pressure past this point. The break is located beneath the slab near the laundry room doorway. Due to depth and location, repair will require interior access and tunneling approximately 25 ft from the garage side clean-out."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Test Results -->
                            <div class="row mb-3" id="testResultsSection">
                                <div class="col-12">
                                    <h4>Test Results</h4>
                                </div>
                                <div class="col-12">
                                    <p class="text-muted mb-3">Select the test result:</p>
                                    <div class="d-flex flex-column flex-md-row gap-3 mb-3">
                                        <button type="button" class="btn btn-outline-success btn-lg test-result-btn flex-fill" data-test-result="pass">
                                            <i class="fas fa-check-circle me-2"></i>PASS
                                            <small class="d-block mt-1">No leaks or pressure loss detected</small>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger btn-lg test-result-btn flex-fill" data-test-result="fail">
                                            <i class="fas fa-times-circle me-2"></i>FAIL
                                            <small class="d-block mt-1">Leaks or pressure loss detected</small>
                                        </button>
                                    </div>
                                    <input type="hidden" name="testResult" id="testResult" value="">
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="testNotes" class="form-label">Notes</label>
                                        <textarea class="form-control" id="testNotes" rows="3" placeholder="Additional notes about the test results | PVC / ABS / Cast Iron | etc. | Lead present?&#10;Measured lost of water? | Prior plumbing work done by others? | Toilets re-installed?"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Test Parameters -->
                            <div class="row mb-3" style="display: none;">
                                <div class="col-12">
                                    <h4>Test Parameters</h4>
                                </div>
                                <div class="col-md-6" id="testDurationField">
                                    <div class="mb-3">
                                        <label for="testDuration" class="form-label">Test Duration (minutes)</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="testDuration" required min="0" value="60">
                                            <div class="btn-group" role="group">
                                                <button type="button" class="btn btn-outline-secondary duration-btn" data-duration="20">20</button>
                                                <button type="button" class="btn btn-outline-secondary duration-btn" data-duration="40">40</button>
                                                <button type="button" class="btn btn-outline-secondary duration-btn active" data-duration="60">60</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>



                            <!-- Action Buttons -->
                            <div class="row">
                                <div class="col-12 d-flex flex-column flex-md-row justify-content-between gap-3">
                                    <button type="button" class="btn btn-secondary" id="resetForm">Reset Form</button>
                                    <div class="d-flex flex-wrap gap-3">
                                        <button type="button" class="btn btn-primary" id="previewReport">Report</button>
                                        <button type="button" class="btn btn-success" id="generateInvoice">Invoice</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="previewModalLabel">Click Plumbing Test Report Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="reportPreview" class="p-3"></div>
                </div>
                <div class="modal-footer d-flex flex-column flex-sm-row gap-2">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="downloadPDF">Download PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div class="modal fade" id="invoiceModal" tabindex="-1" aria-labelledby="invoiceModalLabel" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="invoiceModalLabel">Click Plumbing Invoice Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="invoicePreview" class="p-3"></div>
                </div>
                <div class="modal-footer d-flex flex-column flex-sm-row gap-2">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="downloadInvoice">Download Invoice PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Template (Hidden) -->
    <div id="invoiceTemplate" style="display: none;">
        <div class="invoice-container">
            <div class="invoice-header">
                <div class="company-logo">
                    <img src="img/logo-wide.png" alt="Click Plumbing Logo" id="invoiceCompanyLogo" style="height: 80px; width: auto;">
                </div>
                <div class="invoice-title">
                    <h2>INVOICE</h2>
                    <p class="invoice-date">Date: <span id="invoiceDate"></span></p>
                    <p class="invoice-number">Invoice #: <span id="invoiceNumber"></span></p>
                </div>
            </div>
            
            <div class="invoice-addresses">
                <div class="from-address">
                    <h4>From:</h4>
                    <p><strong>CLICK PLUMBING LLC</strong></p>
                    <p>5501 BALCONES DR STE A 141</p>
                    <p>AUSTIN TX 78731</p>
                </div>
                <div class="to-address">
                    <h4>Bill To:</h4>
                    <p><strong>Done Right Foundation Repair</strong></p>
                    <p>115 E Huebinger</p>
                    <p>Marion TX 78124</p>
                </div>
            </div>
            
            <div class="invoice-items">
                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="invoiceDescription">Hydrostatic Test for [Address]</td>
                            <td>1</td>
                            <td id="invoiceUnitPrice">$250.00</td>
                            <td id="invoiceAmount">$250.00</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3" class="text-end"><strong>Total:</strong></td>
                            <td id="invoiceTotal">$250.00</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            
            <div class="invoice-notes">
                <h4>Notes:</h4>
                <p>Thank you for your business! Payment is due upon receipt.</p>
                <p style="white-space: pre-line; margin-top: 15px;">I hereby certify that the Hydrostatic Test was performed according to industry standards and local code requirements. All reports only represent measurements taken at this time.

Malachi Whites (#RMP41130)
CLICK PLUMBING LLC
Office: (801) 252-5155
TSBPE: 929 East 41st St Austin TX 78751</p>
            </div>
            
            <div class="invoice-footer">
                <!-- Contact information removed as requested -->
            </div>
        </div>
    </div>

    <!-- Report Template (Hidden) -->
    <div id="reportTemplate" style="display: none;">
        <div class="report-container">
            <div class="report-header">
                <div class="company-logo">
                    <img src="img/logo-wide.png" alt="Click Plumbing Logo" id="companyLogo" style="height: 80px; width: auto;">
                </div>
                <div class="report-title">
                    <h2><span id="reportTestTypeTitle">Hydrostatic Test</span> Report</h2>
                    <p class="report-date">Date: <span id="reportDate"></span></p>
                </div>
            </div>
            
            <div class="report-sections-row">
                <div class="report-section half-width">
                    <h3>Customer Information</h3>
                    <div class="report-field">
                        <label>Name:</label>
                        <span id="reportCustomerName"></span>
                    </div>
                    <div class="report-field">
                        <label>Email:</label>
                        <span id="reportCustomerEmail"></span>
                    </div>
                    <div class="report-field">
                        <label>Phone:</label>
                        <span id="reportCustomerPhone"></span>
                    </div>
                    <div class="report-field">
                        <label>Company:</label>
                        <span id="reportCustomerCompany"></span>
                    </div>
                </div>
                
                <div class="report-section half-width">
                    <h3>Test Location</h3>
                    <div class="report-field">
                        <label>Address:</label>
                    </div>
                    <div class="report-address">
                        <span id="reportAddress"></span><br>
                        <span id="reportCityStateZip"></span>
                    </div>
                    <div class="report-field" id="reportDateBelowLocation" style="display: none;">
                        <label>Date:</label>
                        <span id="reportTestDateBelowLocation"></span>
                    </div>
                </div>
            </div>
            
            <div class="report-section">
                <h3>Test Details</h3>
                <div class="report-grid two-columns">
                    <div class="report-field" id="reportTestTypeField">
                        <label>Test Type:</label>
                        <span id="reportTestType"></span>
                    </div>
                    <div class="report-field" id="reportTestDateField">
                        <label>Date:</label>
                        <span id="reportTestDate"></span>
                    </div>
                    <div class="report-field" id="reportSystemTestedField">
                        <label>System Tested:</label>
                        <span id="reportSystemTested"></span>
                    </div>
                    <div class="report-field" id="reportTestDurationField">
                        <label>Test Duration (minutes):</label>
                        <span id="reportTestDuration"></span>
                    </div>
                </div>
                <div class="report-field full-width" id="pinpointTestDetails" style="display: none;">
                    <div class="report-field">
                        <label>Pinpoint Location:</label>
                        <span id="reportPinpointLocation"></span>
                    </div>
                    <div class="report-field">
                        <label>Pinpoint Test Method:</label>
                        <span id="reportPinpointMethod"></span>
                    </div>
                    <div class="report-field">
                        <label>Pinpoint Findings:</label>
                        <p id="reportPinpointFindings"></p>
                    </div>
                </div>
                <div class="report-field" id="reportTestMethodField">
                    <label>Test Method:</label>
                    <span id="reportTestMethod"></span>
                </div>
            </div>
            
            <!-- Standard Test Results (hidden for pinpoint tests) -->
            <div class="report-section" id="reportStandardTestResultsSection">
                <h3>Test Results</h3>
                <div class="report-field full-width">
                    <span id="reportResult"></span>
                </div>
                <div class="report-field full-width">
                    <label>Conclusion:</label>
                    <span id="reportConclusion"></span>
                </div>
                <div class="report-field full-width">
                    <label>Notes:</label>
                    <span id="reportNotes"></span>
                </div>
            </div>
            
            <!-- Pinpoint Test Results (replaces Test Results section for pinpoint tests) -->
            <div class="report-section" id="reportPinpointResultsSection" style="display: none;">
                <h3>Test Results</h3>
                <div class="report-field full-width">
                    <div class="report-field">
                        <label>Pinpoint Location:</label>
                        <span id="reportPinpointResultsLocation"></span>
                    </div>
                    <div class="report-field">
                        <label>Pinpoint Test Method:</label>
                        <span id="reportPinpointResultsMethod"></span>
                    </div>
                    <div class="report-field">
                        <label>Pinpoint Findings:</label>
                        <p id="reportPinpointResultsFindings"></p>
                    </div>
                </div>
            </div>
            
            <div class="report-section">
                <h3>Certification</h3>
                <p id="reportCertification" style="white-space: pre-line;"></p>
            </div>
            
            <div class="report-footer">
                <!-- Contact information removed as requested -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app-fixed.js"></script>
</body>
</html>
